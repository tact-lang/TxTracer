const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BFtIVsi3.js","./index-vZnumMPX.js","./ton-vendor-BFbNzg9b.js","./monaco-editor-core-BIQJaXaq.js","./monaco-editor-core-GL-q52Lm.css","./index-DnzsdLX8.css","./InlineLoader-BKehtFpL.js","./ton-assembly-test-dev-B6NBR68N.js","./index-51kCobSY.css"])))=>i.map(i=>d[i]);
var W=Object.defineProperty;var z=(s,n,e)=>n in s?W(s,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[n]=e;var I=(s,n,e)=>z(s,typeof n!="symbol"?n+"":n,e);import{_ as Y}from"./monaco-editor-core-BIQJaXaq.js";import{j as o,B as J,r as i,u as q,R as Q}from"./index-vZnumMPX.js";import{d as _,a as y,F as X,I as Z}from"./InlineLoader-BKehtFpL.js";import{m as ee,f as te,u as se,a as oe,n as j,S as ne,T as ae}from"./useTraceStepper-6nDCz33W.js";import{r as re}from"./ton-sandbox-BRv3I3nS.js";import ie from"./index-2oDCe-lt.js";import{B as ce,d as le,S as de}from"./ButtonLoader-DyyvWIKK.js";import"./ton-vendor-BFbNzg9b.js";import"./ton-assembly-test-dev-B6NBR68N.js";var N=re();function ue(s){const n=new y.TupleBuilder;for(const e of s)switch(e.$){case"Integer":n.writeNumber(e.value);break;case"Cell":try{const l=y.Cell.fromHex(e.boc);n.writeCell(l)}catch{console.warn("Invalid cell BoC, skipping:",e.boc)}break;case"Slice":try{const l=y.Cell.fromHex(e.hex);n.writeSlice(l.beginParse())}catch{console.warn("Invalid slice hex, skipping:",e.hex)}break;case"Null":break;default:console.warn("Unsupported stack element type:",e.$)}return n}const me=async(s,n=0,e=[])=>{class l{constructor(g,h){I(this,"address");I(this,"init");this.address=g,this.init=h}async send(g,h,E,b){await g.internal(h,{...E,body:b})}async getAny(g,h,E){const b=ue(E),v=await g.get(h,b.build());return[v.stack,v.vmLogs]}}const c=await N.Blockchain.create();c.verbosity.print=!1,c.verbosity.vmLogs="vm_logs_verbose";const d=await c.treasury("treasure"),a={code:s,data:new y.Cell},u=y.contractAddress(0,a),x=new l(u,a),C=c.openContract(x);await C.send(d.getSender(),{value:y.toNano("10")},new y.Cell);const[m,S]=await C.getAny(n,e);return[m,S]};class xe extends Error{constructor(n){super(n),this.name="TasmCompilationError"}}const pe=async(s,n=[])=>{const e=_.text.parse("playground.tasm",s);if(e.$==="ParseFailure"){const a=e.error.loc,u=a.file+":"+(a.line+1);throw new xe(u+": "+e.error.message)}const[l,c]=_.runtime.compileCellWithMapping(e.instructions),d=ee.createMappingInfo(c);try{const[a,u]=await me(l,0,n),x=_.trace.createTraceInfoPerTransaction(u,d,void 0)[0];return{stack:a,vmLogs:u,instructions:e.instructions,code:s,mappingInfo:d,exitCode:void 0,traceInfo:x}}catch(a){if(a instanceof N.GetMethodError){const u=_.trace.createTraceInfoPerTransaction(a.vmLogs,d,void 0)[0],x=te(a.vmLogs,d);return{stack:{items:[],remaining:0},vmLogs:a.vmLogs,instructions:e.instructions,code:s,mappingInfo:d,exitCode:x,traceInfo:u}}throw a}},Ce="_traceViewWrapper_1d17s_1",ge="_headerContent_1d17s_10",he="_txStatusContainer_1d17s_15",fe="_mainActionContainer_1d17s_22",ye="_appContainer_1d17s_30",Se="_mainContent_1d17s_38",Ee="_executeButton_1d17s_77",f={traceViewWrapper:Ce,headerContent:ge,txStatusContainer:he,mainActionContainer:fe,appContainer:ye,mainContent:Se,executeButton:Ee};function be(s){return o.jsx(J,{onClick:s.onClick,disabled:s.disabled,className:f.executeButton,title:s.disabled?"Executing Assembly Code...":"Execute Assembly Code (Ctrl/Cmd+Enter)","aria-label":s.disabled?"Executing assembly code...":"Execute assembly code","aria-describedby":"execution-status","aria-keyshortcuts":"Control+Enter",children:s.disabled?o.jsx(ce,{children:"Execute"}):o.jsxs(o.Fragment,{children:[o.jsx(X,{size:16,"aria-hidden":"true"}),"Execute"]})})}const ve=Q.lazy(()=>Y(()=>import("./index-BFtIVsi3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url)),_e=`SETCP 0
PUSHINT_8 42
PUSHINT_8 100
ADD
PUSHINT_16 200
SUB

NOP
`,A="txtracer-playground-assembly-code",T="txtracer-playground-initial-stack";function De(){const[s,n]=i.useState(()=>{const t=le();return t||(localStorage.getItem(A)??_e)}),[e,l]=i.useState(void 0),[c,d]=i.useState(!1),[a,u]=i.useState(()=>{try{const t=localStorage.getItem(T);return t?JSON.parse(t,(r,p)=>{if(r==="value"&&typeof p=="string"&&p.match(/^-?\d+$/))try{return BigInt(p)}catch{return p}return p}):[]}catch(t){return localStorage.removeItem(T),console.warn("Failed to restore initial stack from localStorage:",t),[]}}),{setError:x,clearError:C}=q(),m=e?.traceInfo,{selectedStep:S,currentStep:L,currentStack:g,totalSteps:h,canGoPrev:E,canGoNext:b,handlePrev:v,handleNext:P,goToFirstStep:B,goToLastStep:D,findStepByLine:F,highlightLine:G,transitionType:M}=se(m),R=oe(m),O=i.useMemo(()=>m?m.steps.map(t=>({name:t.instructionName,gasCost:j(t)})):[],[m]),$=i.useMemo(()=>{if(!m)return 0;let t=0;for(let r=0;r<S;r++){const p=m.steps[r];p&&(t+=j(p))}return t},[m,S]),k=i.useCallback(async()=>{if(s.trim()){d(!0),C(),l(void 0);try{const t=await pe(s,a);l(t),console.log(t.vmLogs)}catch(t){const r=t instanceof Error?t.message:"Unknown error";x(`Failed to execute assembly code: ${r}`)}finally{d(!1)}}},[s,C,a,x]);i.useEffect(()=>{const t=r=>{(r.ctrlKey||r.metaKey)&&r.key==="Enter"&&(r.preventDefault(),c||k())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[k,c]),i.useEffect(()=>{localStorage.setItem(A,s)},[s]),i.useEffect(()=>{try{localStorage.setItem(T,JSON.stringify(a,(t,r)=>typeof r=="bigint"?r.toString():r))}catch(t){console.warn("Failed to save initial stack to localStorage:",t)}},[a]);const U=i.useCallback(t=>{n(t),l(void 0),C()},[C]),H=i.useCallback(t=>{u(t),l(void 0)},[]),w=i.useMemo(()=>{if(e)return e.exitCode&&e.exitCode.num!==0?"failed":"success"},[e]),K=w!==void 0,V=`Exit code: ${e?.exitCode?.num??0}`;return o.jsxs("div",{className:f.traceViewWrapper,children:[o.jsxs(ie,{pageTitle:"playground",children:[K&&o.jsx("div",{className:f.txStatusContainer,role:"status","aria-live":"polite",children:w&&o.jsx(ne,{type:w,text:V})}),o.jsx("div",{className:f.headerContent,children:o.jsxs("div",{className:f.mainActionContainer,role:"toolbar","aria-label":"Assembly code actions",children:[o.jsx(be,{onClick:()=>void k(),disabled:c}),o.jsx(de,{value:s})]})})]}),o.jsxs("div",{id:"execution-status",className:"sr-only","aria-live":"polite","aria-atomic":"true",children:[c&&"Executing assembly code...",e&&!c&&"Assembly code executed successfully",e?.exitCode&&e.exitCode.num!==0&&!c&&`Execution completed with exit code ${e.exitCode.num}`]}),o.jsx("div",{className:"sr-only",children:"Press Ctrl+Enter or Cmd+Enter to execute the assembly code"}),o.jsx("main",{className:f.appContainer,role:"main","aria-label":"Assembly code playground",children:o.jsxs("div",{className:f.mainContent,children:[o.jsxs("div",{style:{flex:"1",position:"relative"},children:[o.jsx("h2",{id:"code-editor-heading",className:"sr-only",children:"Assembly Code Editor"}),o.jsx(i.Suspense,{fallback:o.jsx(Z,{message:"Loading Editor...",loading:!0}),children:o.jsx(ve,{code:s,onChange:U,readOnly:!1,highlightLine:G,lineExecutionData:R,shouldCenter:M==="button",exitCode:e?.exitCode,onLineClick:F})})]}),o.jsx(ae,{selectedStep:S,totalSteps:h,currentStep:L,currentStack:g,canGoPrev:E,canGoNext:b,onPrev:v,onNext:P,onFirst:B,onLast:D,placeholderMessage:"Ready to execute",instructionDetails:O,cumulativeGas:$,showGas:!0,showStackSetup:!0,initialStack:a,onInitialStackChange:H,hasExecutionResults:!!e})]})})]})}export{De as default};
