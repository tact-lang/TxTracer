const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-C2y-G1LZ.js","./InlineLoader-S-9Bqmb0.js","./ton-vendor-BFbNzg9b.js","./ton-assembly-test-dev-B6NBR68N.js","./InlineLoader-DnzsdLX8.css","./monaco-editor-core-BIQJaXaq.js","./monaco-editor-core-GL-q52Lm.css","./index-51kCobSY.css"])))=>i.map(i=>d[i]);
var z=Object.defineProperty;var Y=(o,n,e)=>n in o?z(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e;var j=(o,n,e)=>Y(o,typeof n!="symbol"?n+"":n,e);import{d as _,b as f,j as s,B as J,c as q,R as A,r as i,u as Q,I as X,e as Z,G as ee,T as te,H as se,P as oe}from"./InlineLoader-S-9Bqmb0.js";import{_ as ne}from"./monaco-editor-core-BIQJaXaq.js";import{m as re,f as ae,u as ie,a as ce,n as L,S as le,T as de}from"./useTraceStepper-B5aB6RSL.js";import{r as ue}from"./ton-sandbox-BRv3I3nS.js";import me from"./index-BxfCx1TN.js";import{B as xe,d as pe,S as ge}from"./ButtonLoader-BaP0JVA8.js";import"./ton-vendor-BFbNzg9b.js";import"./ton-assembly-test-dev-B6NBR68N.js";var N=ue();function Ce(o){const n=new f.TupleBuilder;for(const e of o)switch(e.$){case"Integer":n.writeNumber(e.value);break;case"Cell":try{const l=f.Cell.fromHex(e.boc);n.writeCell(l)}catch{console.warn("Invalid cell BoC, skipping:",e.boc)}break;case"Slice":try{const l=f.Cell.fromHex(e.hex);n.writeSlice(l.beginParse())}catch{console.warn("Invalid slice hex, skipping:",e.hex)}break;case"Null":break;default:console.warn("Unsupported stack element type:",e.$)}return n}const he=async(o,n=0,e=[])=>{class l{constructor(C,h){j(this,"address");j(this,"init");this.address=C,this.init=h}async send(C,h,E,b){await C.internal(h,{...E,body:b})}async getAny(C,h,E){const b=Ce(E),v=await C.get(h,b.build());return[v.stack,v.vmLogs]}}const c=await N.Blockchain.create();c.verbosity.print=!1,c.verbosity.vmLogs="vm_logs_verbose";const d=await c.treasury("treasure"),r={code:o,data:new f.Cell},u=f.contractAddress(0,r),x=new l(u,r),g=c.openContract(x);await g.send(d.getSender(),{value:f.toNano("10")},new f.Cell);const[m,S]=await g.getAny(n,e);return[m,S]};class ye extends Error{constructor(n){super(n),this.name="TasmCompilationError"}}const fe=async(o,n=[])=>{const e=_.text.parse("playground.tasm",o);if(e.$==="ParseFailure"){const r=e.error.loc,u=r.file+":"+(r.line+1);throw new ye(u+": "+e.error.message)}const[l,c]=_.runtime.compileCellWithMapping(e.instructions),d=re.createMappingInfo(c);try{const[r,u]=await he(l,0,n),x=_.trace.createTraceInfoPerTransaction(u,d,void 0)[0];return{stack:r,vmLogs:u,instructions:e.instructions,code:o,mappingInfo:d,exitCode:void 0,traceInfo:x}}catch(r){if(r instanceof N.GetMethodError){const u=_.trace.createTraceInfoPerTransaction(r.vmLogs,d,void 0)[0],x=ae(r.vmLogs,d);return{stack:{items:[],remaining:0},vmLogs:r.vmLogs,instructions:e.instructions,code:o,mappingInfo:d,exitCode:x,traceInfo:u}}throw r}},Se="_traceViewWrapper_1d17s_1",Ee="_headerContent_1d17s_10",be="_txStatusContainer_1d17s_15",ve="_mainActionContainer_1d17s_22",_e="_appContainer_1d17s_30",ke="_mainContent_1d17s_38",we="_executeButton_1d17s_77",y={traceViewWrapper:Se,headerContent:Ee,txStatusContainer:be,mainActionContainer:ve,appContainer:_e,mainContent:ke,executeButton:we};function je(o){return s.jsx(J,{onClick:o.onClick,disabled:o.disabled,className:y.executeButton,title:o.disabled?"Executing Assembly Code...":"Execute Assembly Code (Ctrl/Cmd+Enter)","aria-label":o.disabled?"Executing assembly code...":"Execute assembly code","aria-describedby":"execution-status","aria-keyshortcuts":"Control+Enter",children:o.disabled?s.jsx(xe,{children:"Execute"}):s.jsxs(s.Fragment,{children:[s.jsx(q,{size:16,"aria-hidden":"true"}),"Execute"]})})}const Te=A.lazy(()=>ne(()=>import("./index-C2y-G1LZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url)),Ie=`SETCP 0
PUSHINT_8 42
PUSHINT_8 100
ADD
PUSHINT_16 200
SUB

NOP
`,P="txtracer-playground-assembly-code",T="txtracer-playground-initial-stack";function Le(){const[o,n]=i.useState(()=>{const t=pe();return t||(localStorage.getItem(P)??Ie)}),[e,l]=i.useState(void 0),[c,d]=i.useState(!1),[r,u]=i.useState(()=>{try{const t=localStorage.getItem(T);return t?JSON.parse(t,(a,p)=>{if(a==="value"&&typeof p=="string"&&p.match(/^-?\d+$/))try{return BigInt(p)}catch{return p}return p}):[]}catch(t){return localStorage.removeItem(T),console.warn("Failed to restore initial stack from localStorage:",t),[]}}),{setError:x,clearError:g}=Q(),m=e?.traceInfo,{selectedStep:S,currentStep:I,currentStack:C,totalSteps:h,canGoPrev:E,canGoNext:b,handlePrev:v,handleNext:B,goToFirstStep:M,goToLastStep:D,findStepByLine:G,highlightLine:R,transitionType:F}=ie(m),O=ce(m),$=i.useMemo(()=>m?m.steps.map(t=>({name:t.instructionName,gasCost:L(t)})):[],[m]),H=i.useMemo(()=>{if(!m)return 0;let t=0;for(let a=0;a<S;a++){const p=m.steps[a];p&&(t+=L(p))}return t},[m,S]),k=i.useCallback(async()=>{if(o.trim()){d(!0),g(),l(void 0);try{const t=await fe(o,r);l(t),console.log(t.vmLogs)}catch(t){const a=t instanceof Error?t.message:"Unknown error";x(`Failed to execute assembly code: ${a}`)}finally{d(!1)}}},[o,g,r,x]);i.useEffect(()=>{const t=a=>{(a.ctrlKey||a.metaKey)&&a.key==="Enter"&&(a.preventDefault(),c||k())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[k,c]),i.useEffect(()=>{localStorage.setItem(P,o)},[o]),i.useEffect(()=>{try{localStorage.setItem(T,JSON.stringify(r,(t,a)=>typeof a=="bigint"?a.toString():a))}catch(t){console.warn("Failed to save initial stack to localStorage:",t)}},[r]);const U=i.useCallback(t=>{n(t),l(void 0),g()},[g]),K=i.useCallback(t=>{u(t),l(void 0)},[]),w=i.useMemo(()=>{if(e)return e.exitCode&&e.exitCode.num!==0?"failed":"success"},[e]),W=w!==void 0,V=`Exit code: ${e?.exitCode?.num??0}`;return s.jsxs("div",{className:y.traceViewWrapper,children:[s.jsxs(me,{pageTitle:"playground",children:[W&&s.jsx("div",{className:y.txStatusContainer,role:"status","aria-live":"polite",children:w&&s.jsx(le,{type:w,text:V})}),s.jsx("div",{className:y.headerContent,children:s.jsxs("div",{className:y.mainActionContainer,role:"toolbar","aria-label":"Assembly code actions",children:[s.jsx(je,{onClick:()=>void k(),disabled:c}),s.jsx(ge,{value:o})]})})]}),s.jsxs("div",{id:"execution-status",className:"sr-only","aria-live":"polite","aria-atomic":"true",children:[c&&"Executing assembly code...",e&&!c&&"Assembly code executed successfully",e?.exitCode&&e.exitCode.num!==0&&!c&&`Execution completed with exit code ${e.exitCode.num}`]}),s.jsx("div",{className:"sr-only",children:"Press Ctrl+Enter or Cmd+Enter to execute the assembly code"}),s.jsx("main",{className:y.appContainer,role:"main","aria-label":"Assembly code playground",children:s.jsxs("div",{className:y.mainContent,children:[s.jsxs("div",{style:{flex:"1",position:"relative"},children:[s.jsx("h2",{id:"code-editor-heading",className:"sr-only",children:"Assembly Code Editor"}),s.jsx(i.Suspense,{fallback:s.jsx(X,{message:"Loading Editor...",loading:!0}),children:s.jsx(Te,{code:o,onChange:U,readOnly:!1,highlightLine:R,lineExecutionData:O,shouldCenter:F==="button",exitCode:e?.exitCode,onLineClick:G})})]}),s.jsx(de,{selectedStep:S,totalSteps:h,currentStep:I,currentStack:C,canGoPrev:E,canGoNext:b,onPrev:v,onNext:B,onFirst:M,onLast:D,placeholderMessage:"Ready to execute",instructionDetails:$,cumulativeGas:H,showGas:!0,showStackSetup:!0,initialStack:r,onInitialStackChange:K,hasExecutionResults:!!e})]})})]})}Z.createRoot(document.getElementById("root")).render(s.jsx(A.StrictMode,{children:s.jsx(ee,{children:s.jsx(te,{children:s.jsx(se,{children:s.jsx(oe,{loadingMessage:"Loading Playground...",children:s.jsx(Le,{})})})})})}));
