const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-Dv8vV0mn.js","./index-BgaK83vk.js","./ton-vendor-E5L4Lu3I.js","./monaco-editor-core-BnvmR1fi.js","./monaco-editor-core-GL-q52Lm.css","./index-DnzsdLX8.css","./PageHeader-lipHC_FJ.js","./PageHeader-CpH-Q0Gt.css","./index-51kCobSY.css"])))=>i.map(i=>d[i]);
var W=Object.defineProperty;var z=(s,a,e)=>a in s?W(s,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[a]=e;var I=(s,a,e)=>z(s,typeof a!="symbol"?a+"":a,e);import{_ as Y}from"./monaco-editor-core-BnvmR1fi.js";import{j as n,B as J,r as i,u as q,R as Q}from"./index-BgaK83vk.js";import{j as _,k as y,h as X,M as Z,I as ee}from"./PageHeader-lipHC_FJ.js";import{m as te,f as se,a as ne,u as ae,n as j,S as oe,T as re}from"./useTraceStepper-CNJMjdW6.js";import{r as ie}from"./ton-vendor-E5L4Lu3I.js";import{B as ce,d as le,S as de}from"./ButtonLoader-DTUNUjsJ.js";var N=ie();function ue(s){const a=new y.TupleBuilder;for(const e of s)switch(e.$){case"Integer":a.writeNumber(e.value);break;case"Cell":try{const l=y.Cell.fromHex(e.boc);a.writeCell(l)}catch{console.warn("Invalid cell BoC, skipping:",e.boc)}break;case"Slice":try{const l=y.Cell.fromHex(e.hex);a.writeSlice(l.beginParse())}catch{console.warn("Invalid slice hex, skipping:",e.hex)}break;case"Null":break;default:console.warn("Unsupported stack element type:",e.$)}return a}const me=async(s,a=0,e=[])=>{class l{constructor(g,h){I(this,"address");I(this,"init");this.address=g,this.init=h}async send(g,h,E,b){await g.internal(h,{...E,body:b})}async getAny(g,h,E){const b=ue(E),v=await g.get(h,b.build());return[v.stack,v.vmLogs]}}const c=await N.Blockchain.create();c.verbosity.print=!1,c.verbosity.vmLogs="vm_logs_verbose";const d=await c.treasury("treasure"),o={code:s,data:new y.Cell},u=y.contractAddress(0,o),x=new l(u,o),C=c.openContract(x);await C.send(d.getSender(),{value:y.toNano("10")},new y.Cell);const[m,S]=await C.getAny(a,e);return[m,S]};class xe extends Error{constructor(a){super(a),this.name="TasmCompilationError"}}const pe=async(s,a=[])=>{const e=_.text.parse("playground.tasm",s);if(e.$==="ParseFailure"){const o=e.error.loc,u=o.file+":"+(o.line+1);throw new xe(u+": "+e.error.message)}const[l,c]=_.runtime.compileCellWithMapping(e.instructions),d=te.createMappingInfo(c);try{const[o,u]=await me(l,0,a),x=_.trace.createTraceInfoPerTransaction(u,d,void 0)[0];return{stack:o,vmLogs:u,instructions:e.instructions,code:s,mappingInfo:d,exitCode:void 0,traceInfo:x}}catch(o){if(o instanceof N.GetMethodError){const u=_.trace.createTraceInfoPerTransaction(o.vmLogs,d,void 0)[0],x=se(o.vmLogs,d);return{stack:{items:[],remaining:0},vmLogs:o.vmLogs,instructions:e.instructions,code:s,mappingInfo:d,exitCode:x,traceInfo:u}}throw o}},Ce="_traceViewWrapper_1d17s_1",ge="_headerContent_1d17s_10",he="_txStatusContainer_1d17s_15",fe="_mainActionContainer_1d17s_22",ye="_appContainer_1d17s_30",Se="_mainContent_1d17s_38",Ee="_executeButton_1d17s_77",f={traceViewWrapper:Ce,headerContent:ge,txStatusContainer:he,mainActionContainer:fe,appContainer:ye,mainContent:Se,executeButton:Ee};function be(s){return n.jsx(J,{onClick:s.onClick,disabled:s.disabled,className:f.executeButton,title:s.disabled?"Executing Assembly Code...":"Execute Assembly Code (Ctrl/Cmd+Enter)","aria-label":s.disabled?"Executing assembly code...":"Execute assembly code","aria-describedby":"execution-status","aria-keyshortcuts":"Control+Enter",children:s.disabled?n.jsx(ce,{children:"Execute"}):n.jsxs(n.Fragment,{children:[n.jsx(X,{size:16,"aria-hidden":"true"}),"Execute"]})})}const ve=Q.lazy(()=>Y(()=>import("./index-Dv8vV0mn.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url)),_e=`SETCP 0
PUSHINT_8 42
PUSHINT_8 100
ADD
PUSHINT_16 200
SUB

NOP
`,A="txtracer-playground-assembly-code",T="txtracer-playground-initial-stack";function Ne(){const[s,a]=i.useState(()=>{const t=le();return t||(localStorage.getItem(A)??_e)}),[e,l]=i.useState(void 0),[c,d]=i.useState(!1),[o,u]=i.useState(()=>{try{const t=localStorage.getItem(T);return t?JSON.parse(t,(r,p)=>{if(r==="value"&&typeof p=="string"&&p.match(/^-?\d+$/))try{return BigInt(p)}catch{return p}return p}):[]}catch(t){return localStorage.removeItem(T),console.warn("Failed to restore initial stack from localStorage:",t),[]}}),{setError:x,clearError:C}=q(),m=e?.traceInfo,{selectedStep:S,currentStep:L,currentStack:g,totalSteps:h,canGoPrev:E,canGoNext:b,handlePrev:v,handleNext:P,goToFirstStep:B,goToLastStep:D,findStepByLine:M,highlightLine:F,transitionType:G}=ne(m),R=ae(m),O=i.useMemo(()=>m?m.steps.map(t=>({name:t.instructionName,gasCost:j(t)})):[],[m]),$=i.useMemo(()=>{if(!m)return 0;let t=0;for(let r=0;r<S;r++){const p=m.steps[r];p&&(t+=j(p))}return t},[m,S]),k=i.useCallback(async()=>{if(s.trim()){d(!0),C(),l(void 0);try{const t=await pe(s,o);l(t),console.log(t.vmLogs)}catch(t){const r=t instanceof Error?t.message:"Unknown error";x(`Failed to execute assembly code: ${r}`)}finally{d(!1)}}},[s,C,o,x]);i.useEffect(()=>{const t=r=>{(r.ctrlKey||r.metaKey)&&r.key==="Enter"&&(r.preventDefault(),c||k())};return document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}},[k,c]),i.useEffect(()=>{localStorage.setItem(A,s)},[s]),i.useEffect(()=>{try{localStorage.setItem(T,JSON.stringify(o,(t,r)=>typeof r=="bigint"?r.toString():r))}catch(t){console.warn("Failed to save initial stack to localStorage:",t)}},[o]);const U=i.useCallback(t=>{a(t),l(void 0),C()},[C]),H=i.useCallback(t=>{u(t),l(void 0)},[]),w=i.useMemo(()=>{if(e)return e.exitCode&&e.exitCode.num!==0?"failed":"success"},[e]),K=w!==void 0,V=`Exit code: ${e?.exitCode?.num??0}`;return n.jsxs("div",{className:f.traceViewWrapper,children:[n.jsxs(Z,{pageTitle:"playground",children:[K&&n.jsx("div",{className:f.txStatusContainer,role:"status","aria-live":"polite",children:w&&n.jsx(oe,{type:w,text:V})}),n.jsx("div",{className:f.headerContent,children:n.jsxs("div",{className:f.mainActionContainer,role:"toolbar","aria-label":"Assembly code actions",children:[n.jsx(be,{onClick:()=>void k(),disabled:c}),n.jsx(de,{value:s})]})})]}),n.jsxs("div",{id:"execution-status",className:"sr-only","aria-live":"polite","aria-atomic":"true",children:[c&&"Executing assembly code...",e&&!c&&"Assembly code executed successfully",e?.exitCode&&e.exitCode.num!==0&&!c&&`Execution completed with exit code ${e.exitCode.num}`]}),n.jsx("div",{className:"sr-only",children:"Press Ctrl+Enter or Cmd+Enter to execute the assembly code"}),n.jsx("main",{className:f.appContainer,role:"main","aria-label":"Assembly code playground",children:n.jsxs("div",{className:f.mainContent,children:[n.jsxs("div",{style:{flex:"1",position:"relative"},children:[n.jsx("h2",{id:"code-editor-heading",className:"sr-only",children:"Assembly Code Editor"}),n.jsx(i.Suspense,{fallback:n.jsx(ee,{message:"Loading Editor...",loading:!0}),children:n.jsx(ve,{code:s,onChange:U,readOnly:!1,highlightLine:F,lineExecutionData:R,shouldCenter:G==="button",exitCode:e?.exitCode,onLineClick:M})})]}),n.jsx(re,{selectedStep:S,totalSteps:h,currentStep:L,currentStack:g,canGoPrev:E,canGoNext:b,onPrev:v,onNext:P,onFirst:B,onLast:D,placeholderMessage:"Ready to execute",instructionDetails:O,cumulativeGas:$,showGas:!0,showStackSetup:!0,initialStack:o,onInitialStackChange:H,hasExecutionResults:!!e})]})})]})}export{Ne as default};
